<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Журнал виїздів</title>

<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #eef5f1;
  padding: 20px;
}

.card {
  background: #ffffff;
  max-width: 560px;
  margin: auto;
  padding: 24px;
  border-radius: 14px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.08);
}

h2 {
  margin-top: 0;
  text-align: center;
  color: #065f46;
}

h3 {
  margin-top: 25px;
  color: #047857;
  border-bottom: 1px solid #d1fae5;
  padding-bottom: 6px;
}

label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
  color: #064e3b;
}

input, select {
  width: 100%;
  padding: 8px 10px;
  margin-top: 4px;
  border-radius: 8px;
  border: 1px solid #9ca3af;
  font-size: 14px;
}

input:focus, select:focus {
  outline: none;
  border-color: #10b981;
  box-shadow: 0 0 0 2px rgba(16,185,129,0.2);
}

.grid-3 {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
}

.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

button {
  width: 100%;
  margin-top: 24px;
  padding: 12px;
  background: #059669;
  color: white;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

button:hover {
  background: #047857;
}

.error {
  border-color: #dc2626 !important;
  background: #fef2f2;
}

#errorBox {
  margin-top: 16px;
  color: #dc2626;
  font-weight: 600;
  display: none;
}
</style>
</head>

<body>

<div class="card">

<h2>Запис виїзду</h2>

<label>Тип екіпажу</label>
<select id="type">
  <option value="">— обери —</option>
  <option value="Бойовий">Бойовий</option>
  <option value="Не бойовий">Не бойовий (забезпечення / рекогностування)</option>
</select>

<label>Звідки</label>
<input list="locations" id="from">
<datalist id="locations"></datalist>

<label>Куди</label>
<input list="locations" id="to">

<label id="purposeLabel" style="display:none;">Мета</label>
<input list="purposes" id="purpose" style="display:none;">
<datalist id="purposes"></datalist>

<h3>Склад екіпажу</h3>

<div class="grid-3">
  <input list="people" id="p1" placeholder="1 людина">
  <input list="people" id="p2" placeholder="2 людина">
  <input list="people" id="p3" placeholder="3 людина">
  <input list="people" id="p4" placeholder="4 людина">
  <input list="people" id="p5" placeholder="5 людина">
  <input list="people" id="p6" placeholder="6 людина">
</div>

<div class="grid-2" style="margin-top:10px;">
  <input list="people" id="s1" placeholder="1 супровід">
  <input list="people" id="s2" placeholder="2 супровід">
</div>

<input list="people" id="driver" placeholder="Водій" style="margin-top:10px;">

<datalist id="people"></datalist>

<div id="errorBox"></div>

<button onclick="send()">Відправити</button>

</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxmsbybL9Ka-6VRJZIuWLuh4YV7ojdSBywxvMTq9zI4gdW_VA3Hhwj4O3ACzvT3c50S/exec";

// Завантаження довідників
fetch(SCRIPT_URL)
  .then(r => r.json())
  .then(data => {
    data.people.forEach(v => people.innerHTML += `<option value="${v}">`);
    data.locations.forEach(v => locations.innerHTML += `<option value="${v}">`);
    data.purposes.forEach(v => purposes.innerHTML += `<option value="${v}">`);
  });

// Показ / приховування мети
type.onchange = () => {
  const show = type.value === "Не бойовий";
  purpose.style.display = show ? "block" : "none";
  purposeLabel.style.display = show ? "block" : "none";
  if (!show) purpose.value = "";
};

function clearErrors() {
  errorBox.style.display = "none";
  errorBox.innerText = "";
  document.querySelectorAll(".error").forEach(e => e.classList.remove("error"));
}

function showError(msg, fields = []) {
  errorBox.innerText = msg;
  errorBox.style.display = "block";
  fields.forEach(f => f.classList.add("error"));
}

function send() {
  clearErrors();

  if (!type.value) {
    showError("Оберіть тип екіпажу", [type]);
    return;
  }

  if (!from.value || !to.value) {
    showError("Заповніть поля «Звідки» та «Куди»", [from, to]);
    return;
  }

  if (type.value === "Не бойовий" && !purpose.value) {
    showError("Для не бойового екіпажу потрібно вказати мету", [purpose]);
    return;
  }

  const crewFields = [p1,p2,p3,p4,p5,p6,s1,s2,driver];
  const crewValues = crewFields.map(f => f.value).filter(Boolean);
  const duplicates = crewValues.filter((v,i,a) => a.indexOf(v) !== i);

  if (duplicates.length) {
    crewFields
      .filter(f => duplicates.includes(f.value))
      .forEach(f => f.classList.add("error"));

    showError("Одна і та сама людина вказана декілька разів");
    return;
  }

  const params = new URLSearchParams({
    type: type.value,
    from: from.value,
    to: to.value,
    purpose: purpose.value,
    p1: p1.value,
    p2: p2.value,
    p3: p3.value,
    p4: p4.value,
    p5: p5.value,
    p6: p6.value,
    s1: s1.value,
    s2: s2.value,
    driver: driver.value
  });

  fetch(SCRIPT_URL + "?" + params)
    .then(() => {
      alert("Запис додано");
      location.reload();
    });
}
</script>

</body>
</html>
